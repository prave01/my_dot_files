<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventory App</title>
  <link rel="stylesheet" href="style.css"/>
  <!-- API Script -->
  <script src="js/api.js" type="module"></script>
  <!-- Main Script -->
  <script src="script.js" type="module"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="loginPage">
    <div class="section">
      <h2>Login</h2>
      <div class="login-form">
        <input tabindex="1" type="text" id="loginUsername" placeholder="Username" required>
        <input tabindex="2" type="password" id="loginPassword" placeholder="Password" required>
        <button tabindex="3" id="loginBtn" onclick="login()">Login</button>
        <div id="loginError" class="error-message" style="display: none; color: red; margin-top: 10px;"></div>
      </div>
      <p id="loginMessage" class="message"></p>
    </div>
  </div>

  <div id="appPage" class="hidden">
    <header>
      <div>
        <div>Inventory Checker</div>
        <div id="userInfo" style="font-size: 14px; opacity: 0.9;"></div>
      </div>
      <div>
        <button tabindex="1" class="hamburger" onclick="toggleMenu()" aria-label="Toggle Menu">☰</button>
      </div>
    </header>

    <div id="overlay" onclick="toggleMenu()"></div>

    <div id="sideMenu" class="side-menu" role="navigation">
      <button tabindex="2" id="addBtn" onclick="openAdd()" data-menu-item="0" style="display: none;">➕ Add Item</button>
      <button tabindex="3" onclick="openUpdate()" data-menu-item="1">✏️ Update Item</button>
      <button tabindex="4" id="updateQuantityBtn" onclick="openUpdateQuantity()" data-menu-item="2" style="display: none;">📊 Available Quantity</button>
      <button tabindex="5" id="deleteBtn" onclick="openDelete()" data-menu-item="3" style="display: none;">🗑️ Delete Item</button>
      <button tabindex="6" onclick="showSpares()" data-menu-item="4">📦 Spares List</button>
      <button tabindex="7" onclick="downloadCSV()" data-menu-item="5">⬇️ Download CSV</button>
      <button tabindex="8" id="historyBtn" onclick="openHistory()" data-menu-item="6" style="display: none;">📊 History & Analytics</button>
      <button tabindex="9" id="userManagementBtn" onclick="openUserManagement()" data-menu-item="7" style="display: none;">👥 User Management</button>
      <button tabindex="10" onclick="logout()" data-menu-item="8" style="background: #dc3545; margin-top: 20px;">🚪 Logout</button>
    </div>

    <div id="main" class="section">
      <h3>Search Inventory</h3>
      <input tabindex="10" id="searchInput" oninput="showSuggestions()" placeholder="Search item name">
      <div id="suggestBox" class="suggestions"></div>
      <div class="voice-search-container">
        <button tabindex="11" id="voiceSearchBtn" onclick="startListening()">
          <span id="voiceIcon">🎤</span> 
          <span id="voiceText">Voice Search</span>
        </button>
        <div id="voiceStatus" class="voice-status"></div>
      </div>
      <button tabindex="12" onclick="searchItem()">Search</button>
      <div id="searchResult" class="result"></div>
    </div>

    <!-- Add Section -->
    <div id="addSection" class="section hidden">
      <h3>Add Item</h3>
      <input tabindex="13" id="newItem" oninput="showAddSuggestions()" placeholder="Item name">
      <div id="suggestAdd" class="suggestions"></div>

      <input tabindex="14" id="newMake" placeholder="Make">
      <input tabindex="15" id="newModel" placeholder="Model">
      <input tabindex="16" id="newSpecification" placeholder="Specification">

      <input tabindex="17" id="newRack" placeholder="Rack">
      <input tabindex="18" id="newBin" placeholder="Bin">
      <input tabindex="19" id="newQty" type="number" placeholder="Quantity">

      <button tabindex="20" onclick="addItem()">Add</button>
      <button tabindex="21" class="back-button" onclick="goBack()">Back</button>
    </div>

    <!-- Update Section -->
    <div id="updateSection" class="section hidden">
      <h3>Update Item</h3>
      <input tabindex="22" id="updateItem" oninput="showUpdateSuggestions()" placeholder="Item name">
      <div id="suggestUpdate" class="suggestions"></div>
      
      <div class="update-options">
        <div class="update-option">
          <label for="quantityTaken">Quantity Taken:</label>
          <input tabindex="23" id="quantityTaken" type="number" placeholder="Quantity Taken" min="0">
        </div>
        
        <div id="availableQuantityOption" class="update-option">
          <label for="availableQuantity">Available Quantity (Admin Only):</label>
          <input tabindex="24" id="availableQuantity" type="number" placeholder="Available Quantity" min="0">
        </div>
      </div>
      
      <button tabindex="25" onclick="updateItem()">Update</button>
      <button tabindex="26" class="back-button" onclick="goBack()">Back</button>
    </div>

    <!-- Available Quantity Section (Admin Only) -->
    <div id="updateQuantitySection" class="section hidden">
      <h3>Add to Available Quantity (Admin Only)</h3>
      <input tabindex="27" id="updateQuantityItem" oninput="showAvailableQuantitySuggestions()" placeholder="Item name">
      <div id="suggestAvailableQuantity" class="suggestions"></div>
      <div class="current-quantity-display">
        <label>Current Available Quantity: <span id="currentQuantityDisplay">-</span></label>
      </div>
      <input tabindex="28" id="newAvailableQuantity" type="number" placeholder="Quantity to Add" min="0" oninput="updateQuantityPreview()">
      <div class="quantity-preview">
        <label>New Total Quantity: <span id="newQuantityPreview">-</span></label>
      </div>
      <button tabindex="29" onclick="updateAvailableQuantity()">Add to Available Quantity</button>
      <button tabindex="30" class="back-button" onclick="goBack()">Back</button>
    </div>

    <!-- Delete Section -->
    <div id="deleteSection" class="section hidden">
      <h3>Delete Item</h3>
      <input tabindex="31" id="deleteItem" oninput="showDeleteSuggestions()" placeholder="Item name">
      <div id="suggestDelete" class="suggestions"></div>
      <button tabindex="32" onclick="deleteItem()">Delete</button>
      <button tabindex="33" class="back-button" onclick="goBack()">Back</button>
    </div>

    <!-- Spares List -->
    <div id="sparesSection" class="section hidden">
      <h3>Spares List</h3>
      <div class="spares-controls">
        <button onclick="refreshSparesList()" class="refresh-button">🔄 Refresh List</button>
        <button onclick="downloadCSV()" class="download-button">⬇️ Download CSV</button>
      </div>
      <div id="sparesList"></div>
      <button tabindex="34" class="back-button" onclick="goBack()">Back</button>
    </div>

    <!-- History & Analytics Section -->
    <div id="historySection" class="section hidden">
      <h3>History & Analytics (Admin Only)</h3>
      
      <div class="history-controls">
        <select id="historyMonth">
          <option value="">Select Month</option>
          <option value="0">January</option>
          <option value="1">February</option>
          <option value="2">March</option>
          <option value="3">April</option>
          <option value="4">May</option>
          <option value="5">June</option>
          <option value="6">July</option>
          <option value="7">August</option>
          <option value="8">September</option>
          <option value="9">October</option>
          <option value="10">November</option>
          <option value="11">December</option>
        </select>
        <select id="historyYear">
          <option value="">Select Year</option>
          <option value="2023">2023</option>
          <option value="2024">2024</option>
          <option value="2025">2025</option>
        </select>
        <button onclick="generateHistoryReport()">Generate Report</button>
        <button onclick="clearHistoryData()" class="clear-button">Clear History Data</button>
      </div>

      <div id="historyReport" class="history-report">
        <div class="analytics-grid">
          <div class="analytics-card">
            <h4>📊 Monthly Summary</h4>
            <div id="monthlySummary"></div>
          </div>
          
          <div class="analytics-card">
            <h4>📈 Item Consumption Chart</h4>
            <canvas id="consumptionChart" width="400" height="300"></canvas>
          </div>
          
          <div class="analytics-card">
            <h4>👥 User Activity Chart</h4>
            <canvas id="userActivityChart" width="400" height="300"></canvas>
          </div>
          
          <div class="analytics-card">
            <h4>🔝 Top Consumed Items</h4>
            <div id="topItemsList"></div>
          </div>
        </div>
        
        <div class="detailed-history">
          <h4>📋 Detailed Transaction History</h4>
          <div id="transactionHistory"></div>
        </div>
      </div>

      <button tabindex="50" class="back-button" onclick="goBack()">Back</button>
    </div>

    <!-- User Management Section -->
    <div id="userManagementSection" class="section hidden">
      <h3>User Management</h3>
      
      <div class="user-management-tabs">
        <button tabindex="35" onclick="showAddUserForm()" class="tab-button active" id="addUserTab">Add User/Admin</button>
        <button tabindex="36" onclick="showChangePasswordForm()" class="tab-button" id="changePasswordTab">Change Password</button>
        <button tabindex="37" onclick="showUserList()" class="tab-button" id="userListTab">View Users</button>
      </div>

      <!-- Add User Form -->
      <div id="addUserForm" class="user-form">
        <h4>Add New User/Admin</h4>
        <input tabindex="38" id="newUsername" placeholder="Username" autocomplete="off">
        <input tabindex="39" id="newPassword" type="password" placeholder="Password" autocomplete="new-password">
        <input tabindex="40" id="confirmPassword" type="password" placeholder="Confirm Password" autocomplete="new-password">
        <select tabindex="41" id="newUserRole">
          <option value="user">User</option>
          <option value="admin">Admin</option>
        </select>
        <button tabindex="42" onclick="addNewUser()">Add User</button>
        <div id="addUserMessage" class="message"></div>
      </div>

      <!-- Change Password Form -->
      <div id="changePasswordForm" class="user-form hidden">
        <h4>Change Password</h4>
        <select tabindex="43" id="selectUser">
          <option value="">Select User</option>
        </select>
        <input tabindex="44" id="newPasswordChange" type="password" placeholder="New Password" autocomplete="new-password">
        <input tabindex="45" id="confirmPasswordChange" type="password" placeholder="Confirm New Password" autocomplete="new-password">
        <button tabindex="46" onclick="changePassword()">Change Password</button>
        <div id="changePasswordMessage" class="message"></div>
      </div>

      <!-- User List -->
      <div id="userListForm" class="user-form hidden">
        <h4>Current Users</h4>
        <div id="usersList"></div>
        <button tabindex="47" onclick="refreshUserList()" class="refresh-button">Refresh List</button>
      </div>

      <button tabindex="48" class="back-button" onclick="goBack()">Back</button>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>